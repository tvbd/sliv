<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>[App by BlueCodeXX]</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<style>
@import url("https://fonts.googleapis.com/css2?family=Montserrat&display=swap");
body {
  color: #ffffff;
  background-color: #000;
  font-family: "Montserrat", sans-serif;
  margin: 0;
  padding: 0;
}
.header {
  background: linear-gradient(to right, #111, #000);
  padding: 1rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid #222;
  flex-wrap: wrap;
  gap: 0.5rem;
}
.logo img {
  height: 40px;
  border-radius: 10px;
}
.search-box {
  flex: 1 1 50%;
  max-width: 50%;
  position: relative;
}
.search-box input {
  width: 100%;
  background-color: #111;
  border: 1px solid #333;
  color: #000000;
  border-radius: 12px;
  box-shadow: inset 1px 1px 3px #000, inset -1px -1px 2px #333;
  padding: 0.5rem 1rem;
  padding-right: 5rem;
}
#channelSearch::placeholder {
  color: white !important;
  opacity: 1;
}
.header-buttons {
  display: flex;
  align-items: center;
  gap: 1rem;
}
.header-buttons a {
  color: #0ff;
  transition: color 0.3s;
}
.header-buttons a:hover {
  color: #00ccc0;
}
.container {
  margin: 2rem auto;
  max-width: 1200px;
  padding: 0 1rem;
}
.carousel-section {
  margin: 2rem 0;
}
.carousel-title, #searchTitle {
  font-size: 1.25rem;
  margin: 1rem 0;
  color: #0ff;
  border-left: 4px solid #0ff;
  padding-left: 10px;
  font-weight: 600;
}
.channel-card {
  background: linear-gradient(145deg, #1a1a1a, #000);
  border-radius: 15px;
  padding: 10px;
  text-align: center;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
  transition: 0.3s;
  color: #fff;
  user-select: none;
  height: 160px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.channel-card:hover {
  background: linear-gradient(145deg, #111, #000);
  transform: scale(1.03);
  cursor: pointer;
}
.channel-card img {
  height: 80px;
  object-fit: contain;
  margin-bottom: 10px;
  pointer-events: none;
}
.channel-card h6 {
  margin: 0 0 6px;
  font-size: 0.9rem;
  pointer-events: none;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.badge {
  font-size: 0.7rem;
  margin: 2px 4px 0 4px;
  padding: 2px 6px;
  border-radius: 12px;
  background-color: #0ff;
  color: #000;
  display: inline-block;
  pointer-events: none;
}
.owl-carousel {
  position: relative;
}
.owl-carousel .owl-nav button.owl-prev, .owl-carousel .owl-nav button.owl-next {
  position: absolute;
  top: 35%;
  transform: translateY(-50%);
  background: rgba(0, 0, 0, 0.6) !important;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  color: #0ff !important;
  border: none;
  z-index: 10;
  cursor: pointer;
  transition: background-color 0.3s, color 0.3s;
}
.owl-carousel .owl-nav button.owl-prev {
  left: 0;
}
.owl-carousel .owl-nav button.owl-next {
    right: 0;
}
.owl-carousel .owl-nav button i {
  font-size: 1.5rem;
  line-height: 40px;
  pointer-events: none;
}
.owl-carousel .owl-nav button:hover {
  background-color: #0ff !important;
  color: #000 !important;
}
.owl-carousel .item:hover {
  cursor: pointer;
}
@media (max-width: 768px)
{
  .search-box {
    flex: 100%;
    max-width: 100%;
    margin-top: 1rem;
  }
  .owl-carousel .owl-nav button.owl-prev {
    left: 0;
  }
  .owl-carousel .owl-nav button.owl-next {
    right: 0;
  }
}
#searchResults .channel-card {
  margin-bottom: 1rem;
  height: auto;
}
#searchResults .channel-card img {
  height: 80px;
  object-fit: contain;
  margin-bottom: 10px;
}
#searchResults {
  margin-top: 2rem;
}
.channel-link {
  text-decoration: none;
  color: inherit;
  display: block;
  height: 100%;
}
</style>
</head>
<body>
 
  <div class="header">
    <div class="logo">
      <img id="applogoz" src="https://placehold.co/120x80/31343C/EEE?font=montserrat&text=SonyLiv" alt="BlueCodeXX" />
    </div>

    <div class="search-box">
      <input type="text" class="form-control" id="channelSearch" placeholder="Search Channel By Name" autocomplete="off" />
    </div>

    <div class="header-buttons">
      <a href="admin.php" class="btn btn-danger rounded-pill text-white fw-bold" title="Login"><i class="fa-solid fa-right-to-bracket"></i></a>
      <a href="rest_api.php?action=download_iptvplaylist" class="btn btn-light rounded-pill text-dark fw-bold" title="Download"><i class="fa-solid fa-download"></i></a>
    </div>
  </div>

<div class="container" id="contentContainer"><div class="mt-3 mb-3"><div class="spinner-border text-light" role="status"><span class="visually-hidden">Loading...</span></div></div></div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>

<script>
$(document).ready(function()
{
  appMetaData();
  function appMetaData()
  {
    $.ajax({
      "url": "rest_api.php?action=site_metadata",
      "type": "GET",
      "data": "",
      "success": function(data)
      {
        try { data = JSON.parse(data); }catch(err){}
        if(data.status == "success")
        {
          document.title = "Home :: " + data.data.title;
          $("head").append('<link rel="shortcut icon" href="' + data.data.favicon + '" />');
          $("#applogoz").attr("src", data.data.logo);
        }
      }
    });
  }
  let allChannels = [];
  let allGenres = [];
  let allLanguages = [];
  let searchTimeout = null;
  
  function createCarouselSection(title, items)
  {
    let section = `<div class="carousel-section">
          <h5 class="carousel-title">${title}</h5>
          <div class="owl-carousel owl-theme">`;

    items.forEach((channel) => {
          section += `
            <div class="item">
              <div class="channel-card" title="${channel.title}">
                <a href="play.php?id=${encodeURIComponent(channel.id)}" class="channel-link" title="${channel.title}">
                  <img src="${channel.logo}" alt="${channel.title}" title="${channel.title}" />
                  <h6>${channel.title}</h6>
                  <span class="badge bg-primary text-white">${channel.language}</span>
                  <span class="badge bg-success text-white">${channel.genre}</span>
                </a>
              </div>
            </div>`;
    });
    section += `</div></div>`;
    return section;
  }
  
  function renderCarousels(channels, genres, languages)
  {
    const container = $("#contentContainer");
    container.empty();

    genres.forEach((genre) => {
          const filtered = channels.filter((c) => c.genre === genre);
          if (filtered.length) {
            container.append(createCarouselSection(genre, filtered));
          }
    });
    languages.forEach((language) => {
          const filtered = channels.filter((c) => c.language === language);
          if (filtered.length) {
            container.append(createCarouselSection(language, filtered));
          }
    });

    $(".owl-carousel").owlCarousel({
      loop: true,
      margin: 10,
      nav: true,
      dots: false,
      navText: ['<i class="fa fa-chevron-left"></i>', '<i class="fa fa-chevron-right"></i>'],
      responsive: {
        0: { items: 2 },
        600: { items: 4 },
        1000: { items: 6 },
      }
    });
  }

      function renderSearchResults(channels, query) {
        const container = $("#contentContainer");
        container.empty();

        let safeQuery = $("<div>").text(query).html();

        let titleHtml = `<h5 id="searchTitle" class="carousel-title"> Search Results : ${safeQuery} (${channels.length} Result${channels.length !== 1 ? "s" : ""})</h5>`;
        container.append(titleHtml);

        if (channels.length === 0) {
          container.append('<p class="text-center text-info mt-4">No channels found.</p>');
          return;
        }

        let html = `<div id="searchResults" class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-6 g-3">`;
        channels.forEach((channel) => {
          html += `
            <div class="col">
              <div class="channel-card" title="${channel.title}">
                <a href="play.php?id=${encodeURIComponent(channel.id)}" class="channel-link" title="${channel.title}">
                  <img src="${channel.logo}" alt="${channel.title}" title="${channel.title}" />
                  <h6>${channel.title}</h6>
                  <span class="badge bg-primary text-light">${channel.language}</span>
                  <span class="badge bg-success text-light">${channel.genre}</span>
                </a>
              </div>
            </div>`;
        });
        html += "</div>";

        container.append(html);
      }

      function fetchChannels() {
        $.ajax({
          url: "rest_api.php?action=get_channels",
          type: "POST",
          success: function (res) {
            let json = typeof res === "string" ? JSON.parse(res) : res;
            if (json.status === "success" && json.data.list.length) {
              allChannels = json.data.list;
              allGenres = json.data.genre;
              allLanguages = json.data.language;
              renderCarousels(allChannels, allGenres, allLanguages);
            }
            else
            {
              $("#contentContainer").html(`<div class="fw-bold text-info px-5"> <h4>NO CHANNELS FOUND</h4> </div>`);
            }
          },
          error: function () {
            $("#contentContainer").html(
              '<p class="text-danger text-center">Failed to load channels.</p>'
            );
          },
        });
      }

      $("#channelSearch").on("input", function () {
        clearTimeout(searchTimeout);
        const query = $(this).val().toLowerCase().trim();

        if (!query) {
          renderCarousels(allChannels, allGenres, allLanguages);
          return;
        }

        searchTimeout = setTimeout(() => {
          
          const filtered = allChannels.filter((c) =>
            c.title.toLowerCase().includes(query)
          );
          renderSearchResults(filtered, query);
        }, 300);
  });
  fetchChannels();
});
</script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"61f0e69bfb25474ab8a5b96de1f99771","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"61f0e69bfb25474ab8a5b96de1f99771","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>
</html>
